<!DOCTYPE html>

<html lang="pt-BR">

    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="../style/ModificarPesquisa.css">
        <title>Satisfying.you</title>
    </head>

    <body>

        <a href="Home.html">
            <div class="tituloPagina">
                <img class="icon-smile" src="../icons/smile-icon.png" alt="">
                <header>Satisfying.you</header>
            </div>
        </a>
        <div class="canto-direito">
            <a href="Index.html"><img src="../icons/lixeira.png"class="iconLixeira"></a>
            <a href="Index.html" class="linkSair">Sair</a>
        </div>

            <main>
                <div class="container">
                    <form onsubmit="alterarPesquisa(); return false" action="Home_copy.html" method="get">
                        <h2 class="tituloForm">Atualize os dados da pesquisa</h2>
                        
                        <div class="form-group">
                            <label for="txtNomePesquisa">Nome da pesquisa</label>
                            <input type="text" id="txtNomePesquisa" name="nomePesquisa" placeholder="Carnaval 2024">
                        </div>
                        
                        <div class="form-group">
                            <label for="dtPesquisa">Data</label>
                            <input type="text" id="dtPesquisa" name="dataPesq" placeholder="22/03/2023">
                        </div>
            
                        <div class="form-group">
                            <label for="imgPesquisa">Imagem</label>
                            <input type="file" id="imgPesquisa" name="imgPesq"><br>    
                        </div>

                        <div class="containerCriar">
                            <input type="submit" value="Criar">
                        </div>
                    </form>
                </div>
            </main>

            <script>

                var idPesquisa = obterIdPesquisaDaURL();

                function alterarPesquisa() {
                    var novoNome = document.getElementById('txtNomePesquisa').value;
                    var novaData = document.getElementById('dtPesquisa').value;

                    var novaImagemInput = document.getElementById('imgPesquisa');
                    var novaImagem = novaImagemInput.files[0]

                    var listaPesquisas = JSON.parse(localStorage.getItem('listaPesquisas')) || [];

                    var pesquisaIndex = listaPesquisas.findIndex(function (pesquisa) {
                        return pesquisa.idPesquisa == idPesquisa;
                    });

                    if (pesquisaIndex !== -1) {
                        listaPesquisas[pesquisaIndex].nomePesquisa = novoNome;
                        listaPesquisas[pesquisaIndex].dataPesquisa = novaData;
                        
                        if(novaImagem){
                            var leitor = new FileReader();
                            leitor.onload = function(e) {
                                listaPesquisas[pesquisaIndex].imagemPesquisa = e.target.result;
                                localStorage.setItem('listaPesquisas', JSON.stringify(listaPesquisas));
                                window.location.href = 'Home_copy.html';
                            };
                            leitor.readAsDataURL(novaImagem);
                        }

                    } else{
                        localStorage.setItem('listaPesquisas', JSON.stringify(listaPesquisas));
                        window.location.href = 'Home_copy.html';
                    }
                    
                }

                function obterIdPesquisaDaURL() {
                    const urlParams = new URLSearchParams(window.location.search);
                    return urlParams.get('id');
                }

         </script>
    </body>

</html>